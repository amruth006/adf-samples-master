/* Copyright 2010, 2017, Oracle and/or its affiliates. All rights reserved. */
package oracle.demo.model;

import java.util.ArrayList;
import java.util.List;
import java.util.logging.Level;

import oracle.adf.share.logging.ADFLogger;

import oracle.demo.model.common.AutoReduceAM;
import oracle.demo.model.queries.AllObjectsResultsQueryImpl;

import oracle.jbo.Row;
import oracle.jbo.server.ApplicationModuleImpl;
import oracle.jbo.server.ViewObjectImpl;
// ---------------------------------------------------------------------
// ---    File generated by Oracle ADF Business Components Design Time.
// ---    Wed Jul 11 14:24:34 BST 2012
// ---    Custom code may be added to this class.
// ---    Warning: Do not modify method signatures of generated methods.
// ---------------------------------------------------------------------
public class AutoReduceAMImpl extends ApplicationModuleImpl implements AutoReduceAM {
    private static ADFLogger _logger =
        ADFLogger.createADFLogger(AutoReduceAMImpl.class);
    /**
     * This is the default constructor (do not remove).
     */
    public AutoReduceAMImpl() {
    }

    /**
     * Container's getter for AllObjectsResultsQueryForTable.
     * @return AllObjectsResultsQueryForTable
     */
    public ViewObjectImpl getAllObjectsResultsQueryForTable() {
        return (ViewObjectImpl)findViewObject("AllObjectsResultsQueryForTable");
    }

    /**
     * Container's getter for AutoSuggestList.
     * @return AutoSuggestList
     */
    public ViewObjectImpl getAutoSuggestList() {
        return (ViewObjectImpl)findViewObject("AutoSuggestList");
    }
    
    public List<String> autoSuggestCandidates(String searchTerm, int returnCount){
        if (_logger.isLoggable(Level.CONFIG)) {
            StringBuilder configMsg = new StringBuilder("Params to autoSuggestCandidates: ");
            configMsg.append("searchTerm=");
            configMsg.append(searchTerm);
            configMsg.append(", returnCount=");
            configMsg.append(returnCount);
            _logger.config(configMsg.toString());
        }
        List<String> hits = new ArrayList<String>(returnCount);
        
        AllObjectsResultsQueryImpl termsVO = (AllObjectsResultsQueryImpl)this.getAutoSuggestList();
        termsVO.setsearchTerm(searchTerm);
        termsVO.setRangeSize(returnCount);
        termsVO.executeQuery();
        _logger.info("Hits from autoSuggest " + termsVO.getEstimatedRowCount());
        
        for (Row row : termsVO.getAllRowsInRange()){
            hits.add((String)row.getAttribute("ObjectName"));
        }
        
        if (_logger.isLoggable(Level.CONFIG)) {
            StringBuilder configMsg = new StringBuilder("Hits: ");
            for (String lgHit : hits){
                configMsg.append(lgHit);
                configMsg.append("|");
            }
            _logger.config(configMsg.toString());
        }
        return hits;
    }
}
